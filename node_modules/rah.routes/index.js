var log = require('rah.log');
var fs = require('fs');

var defaultRootApiFolder = 'api';
var defaultRootRoutesFolder = 'routes';


function getApis(route, app) {
    fs.readdirSync(route).forEach(function (file) {
        var filepath = route + '/' + file;
        if (fs.statSync(filepath).isDirectory()) {
            getApis(filepath, app);
        }
        else {
            log.event('API/Route Carregada: ' + filepath);

            if (route.indexOf('./routes') > -1) {
                app.use(route.replace('./routes', ''), require('./../../' + route));
            }
            else {
                app.use(route.replace('.', ''), require('./../../' + route));
            }
        }
    });
}

module.exports = {
    default: function (app) {
        log.event('Carregando Rotas\'s...');
        getApis('./' + defaultRootRoutesFolder, app);
    },
    api: function (app) {
        log.event('Carregando API\'s...');
        getApis('./' + defaultRootApiFolder, app);
    }
}