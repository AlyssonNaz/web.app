var db = require('rah.db');
var Q = require('q');

module.exports = {
    login: function (model) {
        //validar campos
        return new Promise(function (resolve, reject) {
            var User = db.model('user');
            
            User.findOne({ where: { username: model.username } })
                .then(function (user) {
                    if (user.validPassword(model.password))
                        resolve(user.generateToken());
                    else
                        reject(Error("Invalid password"));
                }).catch(function (err) {
                    reject(Error(err));
                });
        });
    },
    register: function (model) {
        //validar campos
        return new Promise(function (resolve, reject) {
            var User = db.model('user');

            User.create({
                email: model.email,
                username: model.username,
                password: model.password
            }).then(function (user) {
                resolve(user.generateToken());
            }).catch(function (err) {
                reject(Error(err));
            });
        })
    }
}